<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Campa√±a Temporal Padrinos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: Arial, sans-serif; margin:0; }

    .campana-padrinos {
      background: linear-gradient(135deg, #ffe082, #ffcc80);
      color: #4e342e;
      text-align: center;
      padding: 2em 1em;
      border-bottom: 4px solid #ff9800;
      animation: fadeIn 1s ease-in-out;
    }
    .contenedor-campana { max-width: 800px; margin:auto; }
    .campana-padrinos h2 { font-size: 2em; margin-bottom:0.5em; cursor:pointer; }
    .campana-padrinos p { font-size:1.2em; margin-bottom:1.5em; }
    .botones-campana { display:flex; justify-content:center; gap:1em; flex-wrap:wrap; margin-top:1em; }
    .btn-campana {
      background-color:#ff6f00; color:white;
      padding:0.8em 1.5em; font-weight:bold;
      border-radius:5px; text-decoration:none;
      display:inline-flex; align-items:center; justify-content:center;
      transition:0.3s; border:none; cursor:pointer;
    }
    .btn-campana:hover { background-color:#e65100; }
    .btn-campana.secundario {
      background-color:transparent; color:#4e342e; border:2px solid #ff6f00;
    }
    .btn-campana.secundario:hover { background-color:#ffcc80; color:#4e342e; }
    .btn-campana i { margin-right:0.5em; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }

    .modal { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal-content {
      background-color:#fff3e0; padding:2em; border-radius:10px;
      max-width:500px; width:90%; position:relative;
    }
    .close { position:absolute; top:10px; right:15px; font-size:1.5em; cursor:pointer; }
    .modal-content input, .modal-content textarea { width:100%; padding:0.8em; margin-bottom:1em; border:1px solid #ccc; border-radius:5px; font-size:1em; }
    .modal-content textarea { resize:vertical; min-height:80px; }
    .mensaje-exito, .mensaje-error { font-weight:bold; margin-top:1em; display:none; }

    .panel-admin { display:none; padding:2em; background:#f5f5f5; }
    .panel-admin h2 { margin-top:0; }
    table { width:100%; border-collapse: collapse; margin-top:1em; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:0.5em; text-align:left; }
    .panel-admin input, .panel-admin textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.4em;
      font-size: 0.9em;
    }
    .btn-campana.eliminar {
      background-color: #e53935;
      color: white;
      margin-top: 0.5em;
    }
    .btn-campana.eliminar:hover {
      background-color: #c62828;
    }
  </style>
</head>
<body>
  <section class="campana-padrinos">
    <div class="contenedor-campana">
      <h2>üéØ Convi√©rtete en Padrino de un Misionero</h2>
      <p>Tu generosidad puede llevar el Evangelio y la ayuda a donde m√°s se necesita. S√© parte del cambio.</p>
      <div class="botones-campana">
        <a href="https://wa.me/526393992678?text=Hola,%20quiero%20informaci√≥n%20sobre%20c√≥mo%20convertirme%20en%20padrino" class="btn-campana" target="_blank" rel="noopener noreferrer"><i class="fab fa-whatsapp"></i> Quiero info por WhatsApp</a>
        <button class="btn-campana secundario" id="btn-mostrar-formulario">Dejar mis datos</button>
        <a href="https://www.misionerosdeguadalupe.org/" class="btn-campana secundario" target="_blank" rel="noopener noreferrer">Conocer M√°s</a>
      </div>
    </div>
  </section>

  <div class="modal" id="modal-formulario">
    <div class="modal-content">
      <span class="close" id="cerrar-modal">&times;</span>
      <h2>Deja tus datos para contactarte</h2>
      <form id="form-padrinos">
        <input type="text" name="nombre" placeholder="Tu nombre" required>
        <input type="email" name="correo" placeholder="Tu correo" required>
        <input type="tel" name="telefono" placeholder="Tu tel√©fono" required>
        <textarea name="mensaje" placeholder="Comentario (opcional)"></textarea>
        <button type="submit" class="btn-campana">Enviar</button>
      </form>
      <p class="mensaje-exito" id="mensaje-exito">¬°Gracias! Te contactaremos pronto.</p>
    </div>
  </div>

  <div class="modal" id="modal-login">
    <div class="modal-content">
      <span class="close" id="cerrar-login">&times;</span>
      <h2>Acceso Administrador</h2>
      <form id="form-login">
        <input type="email" name="correo" placeholder="Correo" required>
        <input type="password" name="password" placeholder="Contrase√±a" required>
        <button type="submit" class="btn-campana">Ingresar</button>
      </form>
      <p class="mensaje-error" id="mensaje-error">Correo o contrase√±a incorrectos</p>
    </div>
  </div>

  <section class="panel-admin" id="panel-admin">
    <h2>Panel de Administrador</h2>
    <button id="btn-logout" class="btn-campana secundario">Cerrar sesi√≥n</button>
    <table id="tabla-prospectos">
      <thead>
        <tr><th>Nombre</th><th>Correo</th><th>Tel√©fono</th><th>Mensaje</th><th>Fecha</th><th>Acciones</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCO3FRhSwH1xLABwVGFSd_YYrbFp0lQEv8",
      authDomain: "pagelalo-1b210.firebaseapp.com",
      databaseURL: "https://pagelalo-1b210-default-rtdb.firebaseio.com",
      projectId: "pagelalo-1b210",
      storageBucket: "pagelalo-1b210.appspot.com",
      messagingSenderId: "1096735980204",
      appId: "1:1096735980204:web:8252ddb9fb484c398dfd09"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const modal = document.getElementById('modal-formulario');
    const btnMostrar = document.getElementById('btn-mostrar-formulario');
    const cerrarModal = document.getElementById('cerrar-modal');
    btnMostrar.addEventListener('click', ()=> modal.style.display='flex');
    cerrarModal.addEventListener('click', ()=> modal.style.display='none');
    window.addEventListener('click', (e)=> { if(e.target==modal) modal.style.display='none'; });

    const form = document.getElementById('form-padrinos');
    const mensajeExito = document.getElementById('mensaje-exito');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const datos = {
        nombre: form.nombre.value,
        correo: form.correo.value,
        telefono: form.telefono.value,
        mensaje: form.mensaje.value,
        fecha: new Date().toLocaleString()
      };
      push(ref(db,'padrinos'), datos)
        .then(()=> { mensajeExito.style.display='block'; form.reset(); })
        .catch(err=>alert('Error: '+err));
    });

    const modalLogin = document.getElementById('modal-login');
    const cerrarLogin = document.getElementById('cerrar-login');
    const tituloBanner = document.querySelector('.campana-padrinos h2');
    const formLogin = document.getElementById('form-login');
    const mensajeError = document.getElementById('mensaje-error');
    const panel = document.getElementById('panel-admin');

    let clicks = 0, timer;
    tituloBanner.addEventListener('click', ()=>{
      clicks++;
      clearTimeout(timer);
      timer = setTimeout(()=>{ clicks=0; }, 1500);
      if(clicks >=5) modalLogin.style.display='flex';
    });
    cerrarLogin.addEventListener('click', ()=> modalLogin.style.display='none');
    window.addEventListener('click', (e)=> { if(e.target==modalLogin) modalLogin.style.display='none'; });

    formLogin.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const correo = formLogin.correo.value.trim();
      const password = formLogin.password.value.trim();
      try {
        await signInWithEmailAndPassword(auth, correo, password);
        modalLogin.style.display='none';
        panel.style.display='block';
        mostrarDatosAdmin();
      } catch(error) {
        mensajeError.style.display='block';
        setTimeout(()=> mensajeError.style.display='none',3000);
      }
    });

    function mostrarDatosAdmin(){
      const tablaBody = document.querySelector('#tabla-prospectos tbody');
      const padrinosRef = ref(db,'padrinos');
      onValue(padrinosRef, snapshot=>{
        tablaBody.innerHTML='';
        snapshot.forEach(child=>{
          const data=child.val();
          const key=child.key;
          const tr=document.createElement('tr');
          tr.innerHTML=`
            <td><input type="text" value="${data.nombre}" data-key="${key}" class="editable nombre"></td>
            <td><input type="email" value="${data.correo}" data-key="${key}" class="editable correo"></td>
            <td><input type="tel" value="${data.telefono}" data-key="${key}" class="editable telefono"></td>
            <td><textarea data-key="${key}" class="editable mensaje">${data.mensaje}</textarea></td>
            <td>${data.fecha}</td>
            <td>
              <button class="btn-campana secundario guardar" data-key="${key}">Guardar</button>
              <button class="btn-campana eliminar" data-key="${key}">Eliminar</button>
            </td>`;
          tablaBody.appendChild(tr);
        });

        document.querySelectorAll('.guardar').forEach(btn => {
          btn.addEventListener('click', () => {
            const key = btn.dataset.key;
            const row = btn.closest('tr');
            const nuevo = {
              nombre: row.querySelector('.nombre').value.trim(),
              correo: row.querySelector('.correo').value.trim(),
              telefono: row.querySelector('.telefono').value.trim(),
              mensaje: row.querySelector('.mensaje').value.trim(),
              fecha: new Date().toLocaleString()
            };
            update(ref(db, 'padrinos/' + key), nuevo)
              .then(() => alert('Registro actualizado correctamente.'))
              .catch(err => alert('Error al guardar: ' + err));
          });
        });

        document.querySelectorAll('.eliminar').forEach(btn => {
          btn.addEventListener('click', () => {
            const key = btn.dataset.key;
            if (confirm('¬øSeguro que deseas eliminar este registro?')) {
              remove(ref(db, 'padrinos/' + key))
                .then(() => alert('Registro eliminado.'))
                .catch(err => alert('Error al eliminar: ' + err));
            }
          });
        });
      });
    }

    const btnLogout = document.getElementById('btn-logout');
    btnLogout.addEventListener('click', async () => {
      try {
        await signOut(auth);
        panel.style.display = 'none';
        alert('Has cerrado sesi√≥n correctamente.');
      } catch (error) {
        alert('Error al cerrar sesi√≥n: ' + error.message);
      }
    });
  </script>
</body>
</html>