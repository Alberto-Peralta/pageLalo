<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Pedido - Art√≠culos Religiosos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-yellow-50">
    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center my-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">üôè Seguimiento de Pedido</h1>
            <p class="text-gray-600 mt-2">Consulta el estado de tu pedido en tiempo real</p>
        </header>

        <div class="max-w-md mx-auto bg-white p-6 rounded-2xl shadow-lg border border-gray-200">
            <div class="mb-4">
                <label for="orderNumberInput" class="block text-gray-600 mb-2 font-medium">Ingresa tu N√∫mero de Pedido:</label>
                <input type="text" id="orderNumberInput" placeholder="Ej: 123456" 
                       class="w-full p-3 bg-gray-50 rounded-lg text-gray-900 border border-gray-300 focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
            </div>
            <button id="searchOrderBtn" class="w-full btn-primary text-lg">
                üîç Buscar Pedido
            </button>
        </div>

        <div id="orderResult" class="max-w-md mx-auto mt-6"></div>

        <div class="max-w-md mx-auto mt-6 text-center">
            <a href="index.html" class="text-yellow-700 hover:text-yellow-800 hover:underline transition-colors">
                ‚Üê Volver al Cat√°logo
            </a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // Configuraci√≥n de Firebase (no necesita cambios)
        const firebaseConfig = {
            apiKey: "AIzaSyCO3FRhSwH1xLABwVGFSd_YYrbFp0lQEv8",
            authDomain: "pagelalo-1b210.firebaseapp.com",
            databaseURL: "https://pagelalo-1b210-default-rtdb.firebaseio.com",
            projectId: "pagelalo-1b210",
            storageBucket: "pagelalo-1b210.firebasestorage.app",
            messagingSenderId: "1096735980204",
            appId: "1:1096735980204:web:8252ddb9fb484c398dfd09"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const appId = 'default-app-id';

        // --- FUNCI√ìN DE B√öSQUEDA CORREGIDA ---
        async function searchOrder() {
            const orderNumberInput = document.getElementById('orderNumberInput').value.trim();
            const orderResult = document.getElementById('orderResult');
            orderResult.innerHTML = `<p class="text-center text-gray-500">Buscando...</p>`;

            if (!orderNumberInput) {
                orderResult.innerHTML = `<p class="text-center text-red-600 font-medium">Por favor, ingresa un n√∫mero de pedido.</p>`;
                return;
            }

            try {
                const ordersRef = ref(db, `/artifacts/${appId}/public/orders`);
                const snapshot = await get(ordersRef);

                if (snapshot.exists()) {
                    const allOrders = snapshot.val();
                    // Convertimos el objeto de pedidos en un array para buscar
                    const ordersArray = Object.values(allOrders);
                    
                    // Buscamos la orden que coincida con el n√∫mero (usamos '==' para ser flexibles con tipos string/number)
                    const foundOrder = ordersArray.find(order => order.orderNumber == orderNumberInput);

                    if (foundOrder) {
                        renderOrderDetails(foundOrder);
                    } else {
                        orderResult.innerHTML = `<p class="text-center text-red-600 font-medium">No se encontr√≥ ning√∫n pedido con ese n√∫mero. Verifica que sea correcto.</p>`;
                    }
                } else {
                    orderResult.innerHTML = `<p class="text-center text-red-600 font-medium">A√∫n no hay pedidos registrados en el sistema.</p>`;
                }
            } catch (error) {
                console.error("Error al buscar el pedido:", error);
                orderResult.innerHTML = `<p class="text-center text-red-600 font-medium">Error al conectar con la base de datos. Intenta m√°s tarde.</p>`;
            }
        }
        
        function renderOrderDetails(order) {
            const orderResult = document.getElementById('orderResult');
            const statusTextMap = {
                'pendiente': '‚è≥ Pendiente', 'confirmado': '‚úÖ Confirmado', 'preparando': 'üë®‚Äçüç≥ Preparando',
                'en_camino': 'üöö En Camino', 'entregado': 'üì¶ Entregado', 'cancelado': '‚ùå Cancelado'
            };
            orderResult.innerHTML = `
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-200 animate-fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">Pedido #${order.orderNumber}</h2>
                        <span class="status-badge status-${order.status}">${statusTextMap[order.status] || order.status}</span>
                    </div>
                    <div class="mb-4 space-y-1">
                        <p><span class="text-gray-500 font-medium">Cliente:</span> ${order.customerName}</p>
                        <p><span class="text-gray-500 font-medium">Fecha:</span> ${new Date(order.timestamp).toLocaleDateString()}</p>
                    </div>
                    <div class="border-t border-gray-200 pt-4 flex justify-between items-center text-lg">
                        <span class="text-gray-800 font-semibold">Total:</span>
                        <span class="text-yellow-700 font-bold">$${order.total.toFixed(2)}</span>
                    </div>
                </div>
                <style>.animate-fade-in { animation: fadeIn 0.5s ease; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }</style>
            `;
        }
        
        document.getElementById('searchOrderBtn').addEventListener('click', searchOrder);
        document.getElementById('orderNumberInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchOrder();
            }
        });
    </script>
</body>
</html>